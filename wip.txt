server {
    listen      10.0.2.15:80;
    server_name  collabora.dev.cc;
    
    # static files
    location ^~ /browser {
        proxy_pass http://collabora.dev.cc:9990;
        proxy_set_header Host $http_host;
    }

    # WOPI discovery URL
    location ^~ /hosting {
        proxy_pass http://collabora.dev.cc:9990;
        proxy_set_header Host $http_host;
    }

   # main websocket
   location ~ ^/cool/(.*)/ws$ {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection "Upgrade";
       proxy_set_header Host $http_host;
       proxy_read_timeout 36000s;
   }
   
   # download, presentation and image upload
   location ~ ^/cool {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Host $http_host;
   }
   
   # Admin Console websocket
   location ^~ /cool/adminws {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection "Upgrade";
       proxy_set_header Host $http_host;
       proxy_read_timeout 36000s;
   }
   
   # Capabilities
   location ^~ /hosting/capabilities {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Host $http_host;
   }
}

server {
    listen      10.0.2.15:80;
    server_name collabora.dev.cc ;

    location / {
        proxy_pass               http://collabora.dev.cc:9990;
        proxy_set_header         Host $host;
        proxy_http_version       1.1;
        proxy_set_header         Upgrade $http_upgrade;
        proxy_set_header         Connection "upgrade";
        client_max_body_size     0;
        
    }
}
server {
    listen 80;
    listen [::]:80;
    server_name  collabora.dev.cc;

    error_log /var/log/nginx/collabora.error;

    # static files
    location ^~ /browser {
    proxy_pass http://127.0.0.1:9990;
    proxy_set_header Host $http_host;
    }

    # WOPI discovery URL
    location ^~ /hosting/discovery {
    proxy_pass http://127.0.0.1:9990;
    proxy_set_header Host $http_host;
    }

    # Capabilities
    location ^~ /hosting/capabilities {
    proxy_pass http://127.0.0.1:9990;
    proxy_set_header Host $http_host;
    }

    # main websocket
    location ~ ^/cool/(.*)/ws$ {
    proxy_pass http://127.0.0.1:9990;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_set_header Host $http_host;
    proxy_read_timeout 36000s;
    }

    # download, presentation and image upload
    location ~ ^/(c|l)ool {
    proxy_pass http://127.0.0.1:9990;
    proxy_set_header Host $http_host;
    }

    # Admin Console websocket
    location ^~ /cool/adminws {
    proxy_pass http://127.0.0.1:9990;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_set_header Host $http_host;
    proxy_read_timeout 36000s;
    }
}

server {
    listen      10.0.2.15:443 ssl http2;
    server_name  collabora.dev.cc;

    ssl_certificate      /etc/coolwsd/fullchain.pem;
    ssl_certificate_key  /etc/coolwsd/privatekey.pem;
    
    # static files
    location ^~ /browser {
        proxy_pass http://collabora.dev.cc:9990;
        proxy_set_header Host $http_host;
    }

    # WOPI discovery URL
    location ^~ /hosting {
        proxy_pass http://collabora.dev.cc:9990;
        proxy_set_header Host $http_host;
    }

   # main websocket
   location ~ ^/cool/(.*)/ws$ {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection "Upgrade";
       proxy_set_header Host $http_host;
       proxy_read_timeout 36000s;
   }
   
   # download, presentation and image upload
   location ~ ^/cool {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Host $http_host;
   }
   
   # Admin Console websocket
   location ^~ /cool/adminws {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection "Upgrade";
       proxy_set_header Host $http_host;
       proxy_read_timeout 36000s;
   }
   
   # Capabilities
   location ^~ /hosting/capabilities {
       proxy_pass http://collabora.dev.cc:9990;
       proxy_set_header Host $http_host;
   }
}

